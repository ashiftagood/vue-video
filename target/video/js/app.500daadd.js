(function(t){function e(e){for(var i,a,r=e[0],l=e[1],c=e[2],d=0,h=[];d<r.length;d++)a=r[d],n[a]&&h.push(n[a][0]),n[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);u&&u(e);while(h.length)h.shift()();return s.push.apply(s,c||[]),o()}function o(){for(var t,e=0;e<s.length;e++){for(var o=s[e],i=!0,r=1;r<o.length;r++){var l=o[r];0!==n[l]&&(i=!1)}i&&(s.splice(e--,1),t=a(a.s=o[0]))}return t}var i={},n={app:0},s=[];function a(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=i,a.d=function(t,e,o){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(o,i,function(e){return t[e]}.bind(null,i));return o},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;s.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"034f":function(t,e,o){"use strict";var i=o("64a9"),n=o.n(i);n.a},"0f30":function(t,e,o){"use strict";var i=o("5e02"),n=o.n(i);n.a},"2e53":function(t,e,o){},"2eb9":function(t,e,o){"use strict";var i=o("5f06"),n=o.n(i);n.a},"56d7":function(t,e,o){"use strict";o.r(e);o("cadf"),o("551c"),o("f751"),o("097d");var i=o("2b0e"),n=o("5c96"),s=o.n(n),a=(o("0fae"),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("router-view")],1)}),r=[],l=(o("034f"),o("2877")),c={},u=Object(l["a"])(c,a,r,!1,null,null,null),d=u.exports,h=o("bc3a"),m=o.n(h),f=o("8c4f"),g=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("vHeader"),o("router-view")],1)},p=[],v=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-menu",{attrs:{"default-active":t.activeIndex,mode:"horizontal",router:!0,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[t._l(t.menus,function(e){return o("el-menu-item",{key:e.id,attrs:{index:e.index}},[t._v(t._s(e.name))])}),o("el-button",{staticClass:"logoutBtn",attrs:{icon:"el-icon-switch-button",circle:""},on:{click:t.logoutHandler}})],2)},b=[],y={name:"vHeader",data:function(){return{menus:[{id:1,index:"/home/videoLive",name:"视频直播"},{id:2,index:"/home/videoHistory",name:"直播历史"}],activeIndex:"/home/videoLive"}},created:function(){this.$router.push("/home/videoLive")},methods:{logoutHandler:function(){this.$store.logout(),this.$router.push("/login")}}},I=y,_=(o("6df5"),Object(l["a"])(I,v,b,!1,null,"0150aee5",null)),w=_.exports,x={name:"home",components:{vHeader:w}},$=x,S=Object(l["a"])($,g,p,!1,null,null,null),k=S.exports,C=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-card",{staticClass:"login-card"},[o("span",{attrs:{slot:"header"},slot:"header"},[t._v("登 录")]),o("el-form",{attrs:{"label-position":"left","label-width":"80px",model:t.loginForm}},[o("el-form-item",{attrs:{label:"用户名"}},[o("el-input",{attrs:{"suffix-icon":"el-icon-user"},model:{value:t.loginForm.userName,callback:function(e){t.$set(t.loginForm,"userName",e)},expression:"loginForm.userName"}})],1),o("el-form-item",{attrs:{label:"密码"}},[o("el-input",{attrs:{type:"password","suffix-icon":"el-icon-lock"},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),o("el-form-item",[o("el-button",{attrs:{id:"subBtn",type:"primary",disabled:t.btnDisabled},on:{click:function(e){return e.stopPropagation(),t.onSubmit(e)}}},[t._v("登 录")])],1)],1)],1)},N=[],O={name:"Login",data:function(){return{loginForm:{userName:"",password:""}}},computed:{btnDisabled:function(){var t=""==this.loginForm.userName||""==this.loginForm.password;return t}},methods:{onSubmit:function(){var t=this,e=new FormData;e.append("username",this.loginForm.userName),e.append("userPwd",this.loginForm.password),this.$axios.post(location.origin.concat("/api/login"),e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){"success"==e.data?(t.$store.login(),t.$router.push("/home")):t.$message.error("用户名或密码错误")}).catch(function(e){t.$message.error("登录失败"),console.log(e)})}}},V=O,L=(o("ea51"),Object(l["a"])(V,C,N,!1,null,"d7efdcfe",null)),P=L.exports,j=o("d225"),F=function t(){Object(j["a"])(this,t),this._state={login:sessionStorage.getItem("dss_login_state")},this.isLogin=function(){return this._state.login},this.login=function(){this._state.login=!0,sessionStorage.setItem("dss_login_state",!0)},this.logout=function(){this._state.login=null,sessionStorage.clear()}},T=new F,B=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-row",[o("el-col",{attrs:{span:4}},[o("el-card",{style:t.cardStyle},[o("div",{attrs:{slot:"header"},slot:"header"},[o("span",[t._v("直播列表")]),o("el-button",{staticClass:"shotBtn",attrs:{icon:"el-icon-refresh",type:"text"},on:{click:t.getVideoList}})],1),t.videos.length>0?o("el-menu",t._l(t.videos,function(e){return o("el-menu-item",{key:e.id},[o("i",{staticClass:"el-icon-video-play"}),o("el-link",{attrs:{slot:"title",underline:!1},on:{click:function(o){return t.changeVideoUrl(e.url,e.name,e.id)}},slot:"title"},[t._v(t._s(e.name))])],1)}),1):o("span",[t._v("暂无直播信息")])],1)],1),o("el-col",{staticClass:"videoRegion",attrs:{span:20}},[o("el-card",{staticStyle:{"text-align":"center"},style:t.cardStyle},[o("div",{attrs:{slot:"header"},slot:"header"},[o("span",[t._v(t._s(t.onPlayTitle))]),o("el-button",{staticClass:"shotBtn",attrs:{round:""},on:{click:t.videoShot}},[t._v("截 图")])],1),o("video",{style:t.videoStyle,attrs:{id:"my-video",controls:"",autoplay:""}},[o("p",[t._v("Your browser does not support the video tag.")])])]),o("el-dialog",{attrs:{visible:t.shotImgDialogVisible,width:"50%"},on:{"update:visible":function(e){t.shotImgDialogVisible=e}}},[o("el-input",{staticStyle:{width:"50%"},attrs:{slot:"title",type:"text",placeholder:"请输入截图名称",maxlength:"20","show-word-limit":""},slot:"title",model:{value:t.shotImgName,callback:function(e){t.shotImgName=e},expression:"shotImgName"}}),o("el-image",{staticStyle:{margin:"0 auto"},attrs:{src:t.shotUrl,fit:"contain"}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.shotImgDialogVisible=!1}}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.uploadShotImg}},[t._v("保 存")])],1)],1)],1)],1)},D=[],R=(o("7f7f"),o("1947")),H={name:"videoLive",data:function(){return{videos:[],onPlayTitle:"暂无",onPlayId:"",videoStyle:{width:.76*screen.availWidth+"px",height:.75*screen.availHeight+"px"},cardStyle:{height:.86*screen.availHeight+"px"},shotImgDialogVisible:!1,shotUrl:"",shotImgName:"",dssUrl:"https://whnikoyo.xyz:8042",shotCount:0,shotBlob:null}},created:function(){this.getVideoList(),setInterval(this.getVideoList,3e4)},methods:{changeVideoUrl:function(t,e,o){var i=R["a"].createPlayer({isLive:!0,type:"flv",url:t});i.attachMediaElement(document.getElementById("my-video")),i.load(),i.play(),this.onPlayTitle=e,this.shotCount=0,this.onPlayId=o,this.$axios.post(location.origin.concat("/api/liveRecord"),{videoId:o,videoName:e}).then(function(t){return console.log(t)}).catch(function(t){return console.log(t)})},getVideoList:function(){var t=this,e=location.origin,o=e+"/api/live/sessions",i=this.dssUrl;this.$axios.post(o).then(function(e){e.data.length>0?t.videos=e.data.map(function(t){return{id:t.Id,name:t.Name,url:i+t["HTTP-FLV"]}}):t.videos=[]}).catch(function(e){console.log(e),t.$message.error("获取直播列表失败")})},videoShot:function(){var t=this,e=document.getElementById("my-video");if(0!=e.readyState){var o=document.createElement("canvas");o.width=e.videoWidth,o.height=e.videoHeight,o.getContext("2d").drawImage(e,0,0,o.width,o.height),this.shotUrl=o.toDataURL(),this.shotImgDialogVisible=!0,this.shotImgName=this.onPlayTitle+"_"+this.shotCount,this.shotCount++,o.toBlob(function(e){return t.shotBlob=e})}else this.$message.error("暂无直播信息，截图失败")},uploadShotImg:function(){var t=this,e=location.origin,o={headers:{"Content-Type":"multipart/form-data"}};this.shotBlob.lastModifiedDate=new Date,this.shotBlob.name=this.shotImgName+".png";var i=new FormData;i.append("shotImg",this.shotBlob,this.shotBlob.name),this.$axios.post(e.concat("/api/shotImg/",this.onPlayId),i,o).then(function(e){"success"==e.data?(t.$message({message:t.shotImgName+"保存成功！",type:"success"}),t.shotImgDialogVisible=!1):t.$message.error(t.shotImgName+"保存失败！")}).catch(function(e){t.$message.error(t.shotImgName+"保存失败！"),console.log(e)}).finally(function(){t.shotBlob=null})}}},U=H,E=(o("0f30"),Object(l["a"])(U,B,D,!1,null,"31817d50",null)),M=E.exports,z=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-collapse",{attrs:{accordion:""},on:{change:t.activeChange}},t._l(t.videoRecords,function(e){return o("el-collapse-item",{key:e.id,attrs:{name:e.id}},[o("span",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.videoName))]),o("el-card",t._l(e.urls,function(e){return o("div",{key:e,staticClass:"imgDiv"},[o("span",{on:{click:function(o){return t.showOrigin(e)}}},[o("el-image",{attrs:{src:e,fit:"contain"}})],1)])}),0)],1)}),1),o("el-dialog",{attrs:{title:t.shotImgTitle,visible:t.shotImgVisible,closed:t.dialogClosed},on:{"update:visible":function(e){t.shotImgVisible=e}}},[o("el-image",{attrs:{src:t.shotImgUrl,fit:"contain"}})],1)],1)},J=[],W={name:"videoHistory",data:function(){return{videoRecords:[],shotImgTitle:"",shotImgUrl:"",shotImgVisible:!1}},created:function(){this.getLiveRecord()},methods:{activeChange:function(t){this.getShotImg(t)},getLiveRecord:function(){var t=this;this.$axios.get(location.origin.concat("/api/liveRecords")).then(function(e){for(var o=e.data,i=0;i<o.length;i++)t.videoRecords.push({id:i,videoId:o[i].videoId,videoName:o[i].videoName,createTime:o[i].createTime,urls:[]})}).catch(function(e){t.$message.error("获取直播历史失败"),console.log(e)})},getShotImg:function(t){var e=this,o=this.videoRecords[t].videoId;this.$axios.get(location.origin.concat("/api/shotImg/",o)).then(function(i){for(var n=i.data,s=0;s<n.length;s++){var a=location.origin.concat("/api/downShotImg/",o,"?imgName=",encodeURIComponent(n[s]));e.videoRecords[t].urls.indexOf(a)<0&&e.videoRecords[t].urls.push(a)}}).catch(function(t){e.$message.error("获取直播截图失败"),console.log(t)})},showOrigin:function(t){this.shotImgUrl=t,this.shotImgVisible=!0},dialogClosed:function(){this.shotImgVisible=!1}}},Y=W,q=(o("2eb9"),Object(l["a"])(Y,z,J,!1,null,"576974ad",null)),A=q.exports;i["default"].use(f["a"]);var G=new f["a"]({routes:[{path:"/",redirect:"/login"},{path:"/login",name:"login",component:P},{path:"/home",name:"home",component:k,children:[{path:"videoLive",component:M},{path:"videoHistory",component:A}],beforeEnter:function(t,e,o){T.isLogin()?o():o("/")}}]});i["default"].config.productionTip=!1,i["default"].use(s.a),i["default"].prototype.$axios=m.a,i["default"].prototype.$store=T,new i["default"]({router:G,render:function(t){return t(d)}}).$mount("#app")},"5e02":function(t,e,o){},"5f06":function(t,e,o){},"64a9":function(t,e,o){},"6df5":function(t,e,o){"use strict";var i=o("b54e"),n=o.n(i);n.a},b54e:function(t,e,o){},ea51:function(t,e,o){"use strict";var i=o("2e53"),n=o.n(i);n.a}});
//# sourceMappingURL=app.500daadd.js.map